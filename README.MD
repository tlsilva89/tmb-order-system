# ğŸ“¦ TMB Order System

Sistema de gestÃ£o de pedidos baseado em arquitetura orientada a eventos (EDA). O projeto utiliza **.NET 10** no backend, **Next.js 15** no frontend e **Azure Service Bus** para mensageria, totalmente orquestrado via **Docker**.

## ğŸš€ Tecnologias

* **Backend:** .NET 10 (Preview), Entity Framework Core, Health Checks.
* **Frontend:** Next.js 16 (App Router), TailwindCSS v4.
* **Banco de Dados:** PostgreSQL.
* **Mensageria:** Azure Service Bus (Producer/Consumer).
* **Infraestrutura:** Docker & Docker Compose.
* **Testes:** xUnit + EF Core In-Memory.
* **Extra:** MÃ³dulo de IA/Analytics (Processamento de Linguagem Natural).

## âš™ï¸ PrÃ©-requisitos

* Docker e Docker Compose instalados.
* (Opcional) .NET SDK 10 e Node.js 20 para desenvolvimento local.

## ğŸƒâ€â™‚ï¸ Como Rodar (Docker)

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/seu-usuario/tmb-order-system.git
cd tmb-order-system
```

### 2. Configure as variÃ¡veis de ambiente

Crie um arquivo `.env` na raiz do projeto (`tmb-order-system/.env`):

```env
POSTGRES_USER=admin
POSTGRES_PASSWORD=adminpassword
POSTGRES_DB=tmb_orders_db
PGADMIN_DEFAULT_EMAIL=admin@tmb.com
PGADMIN_DEFAULT_PASSWORD=admin
# Deixe vazio para rodar em modo Mock (sem Azure), ou insira sua string de conexÃ£o real
AZURE_SERVICE_BUS_CONNECTION_STRING=
```

### 3. Suba a aplicaÃ§Ã£o

```bash
docker compose up -d --build
```

### 4. Acesse os serviÃ§os

* **Frontend:** http://localhost:3000
* **API Swagger:** http://localhost:5080/swagger
* **PgAdmin:** http://localhost:5050

## ğŸ§ª Como Rodar os Testes

Para executar os testes unitÃ¡rios do backend (validaÃ§Ã£o de domÃ­nio e regras de negÃ³cio):

```bash
dotnet test
```

## ğŸ—ï¸ Arquitetura

O sistema Ã© composto por 3 serviÃ§os principais desacoplados:

### API (Tmb.Api):

* Recebe requisiÃ§Ãµes HTTP (POST/GET).
* Salva o pedido no Postgres com status `Pending`.
* Envia um evento `OrderCreated` para a fila do Service Bus.
* Fornece endpoint de IA para processamento de perguntas em linguagem natural.

### Worker (Tmb.Worker):

* Consome a fila em background de forma assÃ­ncrona.
* Garante idempotÃªncia (nÃ£o reprocessa pedidos jÃ¡ finalizados).
* Simula o processamento: `Pending` â†’ `Processing` â†’ (5s) â†’ `Completed`.

### Frontend (tmb-frontend):

* Interface moderna em Next.js.
* Exibe listagem e detalhes com atualizaÃ§Ã£o em tempo real (Polling).
* Inclui Chatbot de Analytics integrado.

## ğŸ§  MÃ³dulo de IA (BÃ´nus)

No topo da tela inicial, hÃ¡ uma barra de perguntas ("Pergunte aos seus dados"). Experimente:

* "Quantos pedidos pendentes?"
* "Qual o valor total vendido?"
* "MÃ©dia dos pedidos?"

O sistema interpreta a intenÃ§Ã£o e converte em queries SQL seguras para responder em tempo real.

## ğŸ“‚ Estrutura do Projeto

```
tmb-order-system/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ Tmb.Api/              # API REST (.NET 10)
â”‚   â”‚   â”œâ”€â”€ Tmb.Worker/           # Worker Service (.NET 10)
â”‚   â”‚   â”œâ”€â”€ Tmb.Shared/           # Models e DTOs compartilhados
â”‚   â”‚   â””â”€â”€ Tmb.Api.Tests/        # Testes UnitÃ¡rios (xUnit)
â”‚   â””â”€â”€ frontend/                 # AplicaÃ§Ã£o Next.js 16
â”œâ”€â”€ docker-compose.yml            # OrquestraÃ§Ã£o dos serviÃ§os
â”œâ”€â”€ .env                          # VariÃ¡veis de ambiente
â””â”€â”€ README.md                     # DocumentaÃ§Ã£o
```

## ğŸ› ï¸ Desenvolvimento Local (Sem Docker)

Caso precise rodar/debugar os serviÃ§os individualmente fora do container:

### Backend (API):

```bash
cd src/backend/Tmb.Api
dotnet run
```

### Worker:

```bash
cd src/backend/Tmb.Worker
dotnet run
```

### Frontend:

```bash
cd src/frontend
npm install
npm run dev
```

## ğŸ› Troubleshooting

### 1. Erro de conexÃ£o com PostgreSQL:

* Verifique se o container estÃ¡ rodando: `docker ps`.
* Se rodar localmente (fora do Docker), altere a connection string no `appsettings.json` para `localhost` em vez de `postgres`.

### 2. Frontend nÃ£o carrega ou dÃ¡ erro de build:

Limpe o cache do Next.js e Docker:

```bash
docker compose down -v
docker compose up -d --build
```

### 3. Worker nÃ£o processa mensagens:

* Verifique os logs: `docker logs tmb_worker`.
* Se nÃ£o configurou a connection string do Azure no `.env`, o worker rodarÃ¡ em modo ocioso (apenas logando o aviso).

## ğŸ“ LicenÃ§a

Este projeto foi desenvolvido como Prova de Conceito (POC).
