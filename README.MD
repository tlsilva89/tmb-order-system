# ğŸ“¦ TMB Order System

Sistema de gestÃ£o de pedidos baseado em arquitetura orientada a eventos (EDA). O projeto utiliza **.NET 10** no backend, **Next.js 16** no frontend e **Azure Service Bus** para mensageria, totalmente orquestrado via **Docker**.

## ğŸš€ Tecnologias

* **Backend:** .NET 10 (Preview), Entity Framework Core, Health Checks.
* **Frontend:** Next.js 16 (App Router), TailwindCSS v4.
* **Banco de Dados:** PostgreSQL.
* **Mensageria:** Azure Service Bus (Producer/Consumer).
* **Infraestrutura:** Docker & Docker Compose.
* **Testes:** xUnit + EF Core In-Memory.
* **Extra:** MÃ³dulo de IA/Analytics (Processamento de Linguagem Natural).

## ğŸ›ï¸ Arquitetura e Fluxo (EDA)

O sistema foi desenhado para ser resiliente e escalÃ¡vel, utilizando o desacoplamento entre a recepÃ§Ã£o do pedido e o seu processamento.

```mermaid
sequenceDiagram
    participant U as UsuÃ¡rio (Frontend)
    participant A as API (.NET 10)
    participant B as Banco (Postgres)
    participant S as Azure Service Bus
    participant W as Worker (Background)

    U->>A: POST /orders
    A->>B: Salva Pedido (Pending)
    A->>S: Publica OrderCreated
    A-->>U: 201 Created
    S->>W: Consome Mensagem
    W->>B: Update Status (Processing)
    Note over W: Aguarda 5s (SimulaÃ§Ã£o)
    W->>B: Update Status (Completed)
    U->>A: GET /orders (Polling)
    A->>B: Select Orders
    A-->>U: Exibe Status Atualizado
```

### DecisÃµes TÃ©cnicas de Senioridade:

* **IdempotÃªncia:** O Worker valida o estado atual do pedido antes de iniciar o processamento, evitando duplicidade em caso de reentrega de mensagens pela fila.
* **Shared Kernel:** CentralizaÃ§Ã£o de modelos em `Tmb.Shared` para garantir consistÃªncia entre serviÃ§os.
* **TransiÃ§Ã£o de Estados:** Fluxo obrigatÃ³rio `Pendente â†’ Processando â†’ Finalizado` controlado via Worker.

## ğŸ› ï¸ Developer Experience (DX)

Projeto focado em facilidade de manutenÃ§Ã£o e diagnÃ³stico:

* **Swagger UI:** DocumentaÃ§Ã£o interativa disponÃ­vel em `/swagger`.
* **Health Checks:** Monitoramento em tempo real da API, Banco e Fila em `/health`.
* **Logs Estruturados:** Rastreabilidade total do ciclo de vida do pedido via console/Docker logs.

## âš™ï¸ PrÃ©-requisitos

* Docker e Docker Compose instalados.
* (Opcional) .NET SDK 10 e Node.js 20 para desenvolvimento local.

## ğŸƒâ€â™‚ï¸ Como Rodar (Docker)

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/seu-usuario/tmb-order-system.git
cd tmb-order-system
```

### 2. Configure as variÃ¡veis de ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
POSTGRES_USER=admin
POSTGRES_PASSWORD=adminpassword
POSTGRES_DB=tmb_orders_db
PGADMIN_DEFAULT_EMAIL=admin@tmb.com
PGADMIN_DEFAULT_PASSWORD=admin
# Deixe vazio para rodar em modo Mock (sem Azure)
AZURE_SERVICE_BUS_CONNECTION_STRING=
```

### 3. Suba a aplicaÃ§Ã£o

```bash
docker compose up -d --build
```

### 4. Acesse os serviÃ§os

* **Frontend:** http://localhost:3000
* **API Swagger:** http://localhost:5080/swagger
* **PgAdmin:** http://localhost:5050

## ğŸ§ª Como Rodar os Testes

```bash
dotnet test
```

## ğŸ§  MÃ³dulo de IA (BÃ´nus)

No topo da tela inicial, hÃ¡ uma barra de perguntas ("Pergunte aos seus dados"). O sistema utiliza NLP simples para converter intenÃ§Ãµes em queries SQL reais:

* *"Quantos pedidos pendentes?"*
* *"Qual o valor total vendido?"*

## ğŸ“‚ Estrutura do Projeto

```text
tmb-order-system/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ Tmb.Api/              # API REST (.NET 10)
â”‚   â”‚   â”œâ”€â”€ Tmb.Worker/           # Worker Service (.NET 10)
â”‚   â”‚   â”œâ”€â”€ Tmb.Shared/           # Models e DTOs compartilhados
â”‚   â”‚   â””â”€â”€ Tmb.Api.Tests/        # Testes UnitÃ¡rios (xUnit)
â”‚   â””â”€â”€ frontend/                 # AplicaÃ§Ã£o Next.js 15
â”œâ”€â”€ docker-compose.yml            # OrquestraÃ§Ã£o
â”œâ”€â”€ .env                          # VariÃ¡veis sensÃ­veis
â””â”€â”€ README.md                     # DocumentaÃ§Ã£o Principal
```

## ğŸ› ï¸ Desenvolvimento Local (Sem Docker)

Caso precise rodar/debugar os serviÃ§os individualmente fora do container:

### Backend (API):

```bash
cd src/backend/Tmb.Api
dotnet run
```

### Worker:

```bash
cd src/backend/Tmb.Worker
dotnet run
```

### Frontend:

```bash
cd src/frontend
npm install
npm run dev
```

## ğŸ› Troubleshooting

* **Erro de conexÃ£o com PostgreSQL:** Verifique se o container estÃ¡ saudÃ¡vel (`docker ps`).
* **Worker ocioso:** Certifique-se de que a string de conexÃ£o do Azure Service Bus estÃ¡ correta no `.env`.

---

**Powered by Thiago Luciano**
